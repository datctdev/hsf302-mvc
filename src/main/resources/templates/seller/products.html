<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S·∫£n Ph·∫©m - E-commerce</title>
    
    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/seller.css}">
</head>
<body>
    <!-- Header -->
    <th:block th:replace="~{fragments/header :: header-simple}"></th:block>
    
    <!-- Navigation -->
    <th:block th:replace="~{fragments/nav-seller :: nav-seller}"></th:block>

    <!-- Main Content -->
    <main class="main-content seller-content">
        <div class="container">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Qu·∫£n L√Ω S·∫£n Ph·∫©m</h2>
                    <a href="/seller/products/add" class="btn btn-primary">+ Th√™m S·∫£n Ph·∫©m</a>
                </div>

                <div class="filters">
                    <label for="statusFilter">L·ªçc theo tr·∫°ng th√°i: </label>
                    <select id="statusFilter" onchange="filterProducts()">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="DRAFT" th:selected="${status == 'DRAFT'}">Nh√°p</option>
                        <option value="PUBLISHED" th:selected="${status == 'PUBLISHED'}">ƒê√£ xu·∫•t b·∫£n</option>
                        <option value="ARCHIVED" th:selected="${status == 'ARCHIVED'}">ƒê√£ l∆∞u tr·ªØ</option>
                    </select>
                </div>

                <!-- Flash Messages -->
                <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
                <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

                <div id="productsContainer" class="products-list">
                    <!-- Products loaded from Model -->
                    <div th:if="${products != null and !products.empty}" th:each="product : ${products}">
                        <div class="product-card" th:with="thumbnailImage=${product.images != null and !product.images.empty ? product.images.?[isThumbnail == true] : null}, 
                                                          firstImage=${product.images != null and !product.images.empty ? product.images[0] : null},
                                                          displayImage=${thumbnailImage != null and !thumbnailImage.empty ? thumbnailImage[0] : firstImage}">
                            <div class="product-image">
                                <img th:if="${displayImage != null}" 
                                     th:src="${displayImage.imageUrl}" 
                                     th:alt="${product.name}"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="product-image-placeholder" th:if="${displayImage == null}">
                                    üì¶
                                </div>
                            </div>
                            <div class="product-info">
                                <h3 th:text="${product.name}">Product Name</h3>
                                <p class="product-sku">SKU: <span th:text="${product.sku}">SKU</span></p>
                                <p class="product-price" th:text="${#numbers.formatDecimal(product.basePrice, 0, 'POINT', 0, 'POINT')} + ' VNƒê'">0 VNƒê</p>
                                <p class="product-description" th:text="${product.description != null and product.description.length() > 100 ? product.description.substring(0, 100) + '...' : (product.description ?: '')}">Description</p>
                                <div class="product-meta">
                                    <span class="status-badge" 
                                          th:classappend="'status-' + ${product.status.toLowerCase()}"
                                          th:text="${product.status == 'PUBLISHED'} ? 'ƒê√£ xu·∫•t b·∫£n' : (${product.status == 'DRAFT'} ? 'Nh√°p' : 'ƒê√£ l∆∞u tr·ªØ')">Status</span>
                                    <span th:if="${product.variants != null and !product.variants.empty}" 
                                          class="variant-count"
                                          th:text="${product.variants.size()} + ' bi·∫øn th·ªÉ'">Variants</span>
                                </div>
                            </div>
                            <div class="product-actions">
                                <a th:href="@{'/seller/products/edit/' + ${product.id}}" class="btn btn-primary">Ch·ªânh s·ª≠a</a>
                                <form th:action="@{'/seller/products/delete/' + ${product.id}}" method="post" style="display: inline;">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button type="submit" class="btn btn-danger" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')">X√≥a</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div th:if="${products == null or products.empty}" class="empty-state">
                        <h3>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</h3>
                        <p>B·∫Øt ƒë·∫ßu b·∫±ng c√°ch th√™m s·∫£n ph·∫©m ƒë·∫ßu ti√™n c·ªßa b·∫°n.</p>
                        <a href="/seller/products/add" class="btn btn-primary">Th√™m S·∫£n Ph·∫©m</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- JavaScript -->
    <script th:src="@{/js/common.js}"></script>
    <script>
        // No need for DOMContentLoaded - data loaded from Model

        function filterProducts() {
            const status = document.getElementById('statusFilter').value;
            const url = status ? '/seller/products?status=' + status : '/seller/products';
            window.location.href = url;
        }

        function getStatusText(status) {
            const statusMap = {
                'DRAFT': 'Nh√°p',
                'PUBLISHED': 'ƒê√£ xu·∫•t b·∫£n',
                'ARCHIVED': 'ƒê√£ l∆∞u tr·ªØ'
            };
            return statusMap[status] || status;
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN').format(price);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
