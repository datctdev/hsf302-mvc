<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Viết Đánh Giá</title>
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/review.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .review-form-container { max-width: 600px; margin: 3rem auto; background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .product-preview { display: flex; gap: 15px; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
        .product-preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 4px; }
        .rating-group { text-align: center; margin-bottom: 2rem; }
        .rating-input { display: flex; flex-direction: row-reverse; justify-content: center; gap: 10px; }
        .rating-input input { display: none; }
        .rating-input label { font-size: 2.5rem; color: #ddd; cursor: pointer; transition: color 0.2s; }
        .rating-input input:checked ~ label, .rating-input label:hover, .rating-input label:hover ~ label { color: #ffc107; }
    </style>
</head>
<body>
<th:block th:replace="~{fragments/header :: header-simple}"></th:block>
<th:block th:replace="~{fragments/nav-home :: nav-home}"></th:block>

<div class="main-content">
    <div class="review-form-container">
        <h2 style="text-align: center; margin-bottom: 1.5rem;">Đánh Giá Sản Phẩm</h2>

        <div class="product-preview">
            <img th:src="${product.images != null and !product.images.empty ? product.images[0].imageUrl : '/images/placeholder.png'}" alt="Product">
            <div>
                <h3 th:text="${product.name}" style="margin: 0 0 5px 0;">Tên sản phẩm</h3>
                <p style="color: #666; font-size: 0.9rem;" th:text="${product.shopName}">Tên Shop</p>
            </div>
        </div>

        <form th:action="@{'/products/' + ${product.id} + '/review'}" method="post" enctype="multipart/form-data" th:object="${createReviewRequest}">

            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

            <input type="hidden" th:field="*{subOrderId}" />

            <div class="rating-group">
                <p style="margin-bottom: 10px; font-weight: 500;">Chất lượng sản phẩm thế nào?</p>
                <div class="rating-input">
                    <input type="radio" id="star5" name="rating" value="5" th:field="*{rating}" /><label for="star5" title="Tuyệt vời"><i class="fas fa-star"></i></label>
                    <input type="radio" id="star4" name="rating" value="4" th:field="*{rating}" /><label for="star4" title="Hài lòng"><i class="fas fa-star"></i></label>
                    <input type="radio" id="star3" name="rating" value="3" th:field="*{rating}" /><label for="star3" title="Bình thường"><i class="fas fa-star"></i></label>
                    <input type="radio" id="star2" name="rating" value="2" th:field="*{rating}" /><label for="star2" title="Không hài lòng"><i class="fas fa-star"></i></label>
                    <input type="radio" id="star1" name="rating" value="1" th:field="*{rating}" /><label for="star1" title="Tệ"><i class="fas fa-star"></i></label>
                </div>
                <small class="text-danger" th:if="${#fields.hasErrors('rating')}" th:errors="*{rating}"></small>
            </div>

            <div class="form-group">
                <label>Chia sẻ cảm nhận của bạn:</label>
                <textarea th:field="*{comment}" rows="4" class="form-control" placeholder="Hãy chia sẻ những điều bạn thích về sản phẩm này nhé..."></textarea>
                <small class="text-danger" th:if="${#fields.hasErrors('comment')}" th:errors="*{comment}"></small>
            </div>

            <div class="form-group">
                <label>Thêm hình ảnh (Tối đa 5 ảnh):</label>
                <input type="file" name="images" multiple accept="image/*" class="form-control">
            </div>

            <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                <a href="/orders" class="btn btn-secondary" style="flex: 1; text-align: center;">Trở lại</a>
                <button type="submit" class="btn btn-primary" style="flex: 1; background-color: #ee4d2d; border-color: #ee4d2d;">Gửi Đánh Giá</button>
            </div>
        </form>
    </div>
</div>

<th:block th:replace="~{fragments/footer :: footer}"></th:block>
</body>
</html>